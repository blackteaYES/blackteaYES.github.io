import{_ as e,V as o,W as c,X as n,Y as s,$ as t,a0 as p,C as l}from"./framework-a71e09ed.js";const u="/assets/img/WebMagic/CSDN图片上传失败.png",i="/assets/img/WebMagic/博客图片示例.png",k="/assets/img/WebMagic/爬取后的资源.png",r="/assets/img/WebMagic/文档中的第一个用例.png",d="/assets/img/WebMagic/issues701.png",m="/assets/img/WebMagic/Downloader接口实现.png",v="/assets/img/WebMagic/PageProcessor实现.png",b="/assets/img/WebMagic/swagger-md下载请求参数.png",g="/assets/img/WebMagic/md下载swagger.png",h="/assets/img/WebMagic/md文件最终效果.png",w="/assets/img/WebMagic/详情zip下载效果.png",y="/assets/img/WebMagic/列表zip下载效果.png",_={},f=n("h1",{id:"springboot整合webmagic",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#springboot整合webmagic","aria-hidden":"true"},"#"),s(" SpringBoot整合WebMagic")],-1),q=n("h2",{id:"前言",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前言","aria-hidden":"true"},"#"),s(" 前言")],-1),S=n("p",null,"  为什么我要整合WebMagic ?",-1),C={href:"http://webmagic.io/",target:"_blank",rel:"noopener noreferrer"},x=n("p",null,"  因为部分网站它不支持外链图片上传,而我已经把我的图片资源上传了,所以我需要把所有的资源进行获取整合再在部分网站重新上传;",-1),j=n("p",null,"  举个🌰:",-1),P=n("figure",null,[n("img",{src:u,alt:"图片上传失败例子",tabindex:"0",loading:"lazy"}),n("figcaption",null,"图片上传失败例子")],-1),T=n("p",null,"  红框里的就是上传失败的。",-1),H=n("p",null,"  很无奈,人家不支持外链地址,那没有办法,自己重新上传吧!",-1),D={href:"http://webmagic.io/",target:"_blank",rel:"noopener noreferrer"},E=p('<p>  如下🌰:</p><p>​ <img src="'+i+'" alt="博客图片示例" loading="lazy"></p><p>  爬取后获得的资源：</p><p>​ <img src="'+k+'" alt="爬取后的资源" loading="lazy"></p><h2 id="文档迭代" tabindex="-1"><a class="header-anchor" href="#文档迭代" aria-hidden="true">#</a> 文档迭代</h2><table><thead><tr><th style="text-align:center;">version</th><th style="text-align:center;">功能</th><th style="text-align:center;">详细描述</th></tr></thead><tbody><tr><td style="text-align:center;">0.0.1</td><td style="text-align:center;">通过整合WebMagic实现了通用列表(多页面)及详细内容(单页面)的通用爬取接口</td><td style="text-align:center;">通用列表(多页面是指列表页面中的详情页),单页就是指的详情页</td></tr></tbody></table><h2 id="项目技术版本-技术选型" tabindex="-1"><a class="header-anchor" href="#项目技术版本-技术选型" aria-hidden="true">#</a> 项目技术版本(技术选型)</h2>',7),z=n("p",null,"jdk - version - 1.8",-1),L=n("p",null,"maven - version - 3.8.1",-1),M=n("p",null,"SpringBoot - version - 2.2.2.RELEASE",-1),A=n("p",null,"Swagger - version - 2.7.0",-1),R=n("p",null,"remark - version - 1.0.0",-1),U=n("p",null,"webmagic - version - 0.7.3",-1),W={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/pom.xml",target:"_blank",rel:"noopener noreferrer"},N=n("h2",{id:"项目地址",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#项目地址","aria-hidden":"true"},"#"),s(" 项目地址")],-1),I={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/tree/master/webmagic",target:"_blank",rel:"noopener noreferrer"},G=n("h2",{id:"前置知识",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前置知识","aria-hidden":"true"},"#"),s(" 前置知识")],-1),B=n("h3",{id:"webmagic-自主学习",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#webmagic-自主学习","aria-hidden":"true"},"#"),s(" WebMagic 自主学习")],-1),F={href:"http://webmagic.io/",target:"_blank",rel:"noopener noreferrer"},O={href:"http://webmagic.io/docs/zh/",target:"_blank",rel:"noopener noreferrer"},V={href:"https://github.com/code4craft",target:"_blank",rel:"noopener noreferrer"},X=p('<p>  假设你已经学习了该项目，可以继续学习了。</p><h2 id="webmagic-简单测试" tabindex="-1"><a class="header-anchor" href="#webmagic-简单测试" aria-hidden="true">#</a> WebMagic 简单测试</h2><p>  文档中的第一个用例:</p><figure><img src="'+r+`" alt="文档中的第一个用例" tabindex="0" loading="lazy"><figcaption>文档中的第一个用例</figcaption></figure><p>  你可以再idea中进行搜索(快速按两次<code>shift</code>),输入<strong>GithubRepoPageProcessor</strong>类就可以发现这个作者已经写好的用例了,我们可以测试一下。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span><span class="token class-name">Site</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span><span class="token class-name">Spider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>processor<span class="token punctuation">.</span></span><span class="token class-name">PageProcessor</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GithubRepoPageProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">PageProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Site</span> site <span class="token operator">=</span> <span class="token class-name">Site</span><span class="token punctuation">.</span><span class="token function">me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRetryTimes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSleepTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GithubRepoPageProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Page</span> page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page<span class="token punctuation">.</span><span class="token function">addTargetRequests</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">links</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">&quot;(https://github\\\\.com/[\\\\w\\\\-]+/[\\\\w\\\\-]+)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        page<span class="token punctuation">.</span><span class="token function">addTargetRequests</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">links</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">&quot;(https://github\\\\.com/[\\\\w\\\\-])&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        page<span class="token punctuation">.</span><span class="token function">putField</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">&quot;https://github\\\\.com/(\\\\w+)/.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        page<span class="token punctuation">.</span><span class="token function">putField</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">getHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">xpath</span><span class="token punctuation">(</span><span class="token string">&quot;//h1[@class=&#39;public&#39;]/strong/a/text()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getResultItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            page<span class="token punctuation">.</span><span class="token function">setSkip</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        page<span class="token punctuation">.</span><span class="token function">putField</span><span class="token punctuation">(</span><span class="token string">&quot;readme&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">getHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">xpath</span><span class="token punctuation">(</span><span class="token string">&quot;//div[@id=&#39;readme&#39;]/tidyText()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Site</span> <span class="token function">getSite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>site<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Spider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GithubRepoPageProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addUrl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;https://github.com/code4craft&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),$={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/test/java/com/blacktea/webmagic/demo/WebMagicTest.java",target:"_blank",rel:"noopener noreferrer"},J=p(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testDemo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Spider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GithubRepoPageProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addUrl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;https://github.com/code4craft&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  运行得到错误内容:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.307</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span></span>QueueScheduler</span> <span class="token operator">-</span> push <span class="token keyword">to</span> <span class="token namespace">queue</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>code4craft
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.730</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span> <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span>Spider</span> <span class="token operator">-</span> <span class="token class-name">Spider</span> github<span class="token punctuation">.</span>com started<span class="token operator">!</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.762</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span></span>RequestAddCookies</span> <span class="token operator">-</span> <span class="token class-name">CookieSpec</span> selected<span class="token operator">:</span> standard
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.766</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span></span>RequestAuthCache</span> <span class="token operator">-</span> <span class="token class-name">Auth</span> cache not set in the context
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.766</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>PoolingHttpClientConnectionManager</span> <span class="token operator">-</span> <span class="token class-name">Connection</span> request<span class="token operator">:</span> <span class="token punctuation">[</span>route<span class="token operator">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">}</span><span class="token operator">-&gt;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">443</span><span class="token punctuation">]</span><span class="token punctuation">[</span>total kept alive<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> route allocated<span class="token operator">:</span> <span class="token number">0</span> of <span class="token number">100</span><span class="token punctuation">;</span> total allocated<span class="token operator">:</span> <span class="token number">0</span> of <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.774</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>PoolingHttpClientConnectionManager</span> <span class="token operator">-</span> <span class="token class-name">Connection</span> leased<span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>route<span class="token operator">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">}</span><span class="token operator">-&gt;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">443</span><span class="token punctuation">]</span><span class="token punctuation">[</span>total kept alive<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> route allocated<span class="token operator">:</span> <span class="token number">1</span> of <span class="token number">100</span><span class="token punctuation">;</span> total allocated<span class="token operator">:</span> <span class="token number">1</span> of <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.775</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>MainClientExec</span> <span class="token operator">-</span> <span class="token class-name">Opening</span> connection <span class="token punctuation">{</span>s<span class="token punctuation">}</span><span class="token operator">-&gt;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">443</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.778</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>DefaultHttpClientConnectionOperator</span> <span class="token operator">-</span> <span class="token class-name">Connecting</span> <span class="token keyword">to</span> <span class="token namespace">github<span class="token punctuation">.</span>com</span><span class="token operator">/</span><span class="token number">140.82</span><span class="token number">.112</span><span class="token number">.4</span><span class="token operator">:</span><span class="token number">443</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">13.778</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLConnectionSocketFactory</span> <span class="token operator">-</span> <span class="token class-name">Connecting</span> socket <span class="token keyword">to</span> <span class="token namespace">github<span class="token punctuation">.</span>com</span><span class="token operator">/</span><span class="token number">140.82</span><span class="token number">.112</span><span class="token number">.4</span><span class="token operator">:</span><span class="token number">443</span> <span class="token keyword">with</span> <span class="token namespace">timeout</span> <span class="token number">10000</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.052</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLConnectionSocketFactory</span> <span class="token operator">-</span> <span class="token class-name">Enabled</span> protocols<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">TLSv1</span><span class="token punctuation">]</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.052</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLConnectionSocketFactory</span> <span class="token operator">-</span> <span class="token class-name">Enabled</span> cipher suites<span class="token operator">:</span><span class="token punctuation">[</span><span class="token constant">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_RSA_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDH_RSA_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_DHE_RSA_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_DHE_DSS_WITH_AES_256_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_ECDH_RSA_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_DHE_RSA_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_DHE_DSS_WITH_AES_128_CBC_SHA</span><span class="token punctuation">,</span> <span class="token constant">TLS_EMPTY_RENEGOTIATION_INFO_SCSV</span><span class="token punctuation">]</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.052</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLConnectionSocketFactory</span> <span class="token operator">-</span> <span class="token class-name">Starting</span> handshake
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.314</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>DefaultManagedHttpClientConnection</span> <span class="token operator">-</span> http<span class="token operator">-</span>outgoing<span class="token operator">-</span><span class="token number">0</span><span class="token operator">:</span> <span class="token class-name">Shutdown</span> connection
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.314</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>MainClientExec</span> <span class="token operator">-</span> <span class="token class-name">Connection</span> discarded
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.314</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>PoolingHttpClientConnectionManager</span> <span class="token operator">-</span> <span class="token class-name">Connection</span> released<span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>route<span class="token operator">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">}</span><span class="token operator">-&gt;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">443</span><span class="token punctuation">]</span><span class="token punctuation">[</span>total kept alive<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> route allocated<span class="token operator">:</span> <span class="token number">0</span> of <span class="token number">100</span><span class="token punctuation">;</span> total allocated<span class="token operator">:</span> <span class="token number">0</span> of <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">14.316</span> <span class="token punctuation">[</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token constant">WARN</span> <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>downloader<span class="token punctuation">.</span></span>HttpClientDownloader</span> <span class="token operator">-</span> download page https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>code4craft error
<span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLHandshakeException</span><span class="token operator">:</span> <span class="token class-name">Received</span> fatal alert<span class="token operator">:</span> protocol_version
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>Alert</span><span class="token punctuation">.</span><span class="token function">createSSLException</span><span class="token punctuation">(</span><span class="token class-name">Alert</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">131</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>Alert</span><span class="token punctuation">.</span><span class="token function">createSSLException</span><span class="token punctuation">(</span><span class="token class-name">Alert</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">117</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>TransportContext</span><span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token class-name">TransportContext</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">340</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>Alert</span>$<span class="token class-name">AlertConsumer</span><span class="token punctuation">.</span><span class="token function">consume</span><span class="token punctuation">(</span><span class="token class-name">Alert</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">293</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>TransportContext</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token class-name">TransportContext</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">186</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLTransport</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">SSLTransport</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">154</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLSocketImpl</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">SSLSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1279</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLSocketImpl</span><span class="token punctuation">.</span><span class="token function">readHandshakeRecord</span><span class="token punctuation">(</span><span class="token class-name">SSLSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1188</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLSocketImpl</span><span class="token punctuation">.</span><span class="token function">startHandshake</span><span class="token punctuation">(</span><span class="token class-name">SSLSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">401</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLSocketImpl</span><span class="token punctuation">.</span><span class="token function">startHandshake</span><span class="token punctuation">(</span><span class="token class-name">SSLSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">373</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLConnectionSocketFactory</span><span class="token punctuation">.</span><span class="token function">createLayeredSocket</span><span class="token punctuation">(</span><span class="token class-name">SSLConnectionSocketFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">436</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span>SSLConnectionSocketFactory</span><span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token class-name">SSLConnectionSocketFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">384</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>DefaultHttpClientConnectionOperator</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">DefaultHttpClientConnectionOperator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">142</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>conn<span class="token punctuation">.</span></span>PoolingHttpClientConnectionManager</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">PoolingHttpClientConnectionManager</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">374</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>MainClientExec</span><span class="token punctuation">.</span><span class="token function">establishRoute</span><span class="token punctuation">(</span><span class="token class-name">MainClientExec</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">393</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>MainClientExec</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">MainClientExec</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">236</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>ProtocolExec</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ProtocolExec</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">186</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>RetryExec</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">RetryExec</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">89</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>execchain<span class="token punctuation">.</span></span>RedirectExec</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">RedirectExec</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">110</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>InternalHttpClient</span><span class="token punctuation">.</span><span class="token function">doExecute</span><span class="token punctuation">(</span><span class="token class-name">InternalHttpClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">185</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>CloseableHttpClient</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">CloseableHttpClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>downloader<span class="token punctuation">.</span></span>HttpClientDownloader</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token class-name">HttpClientDownloader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span>Spider</span><span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">Spider</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">404</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span>Spider</span><span class="token punctuation">.</span>access$<span class="token function">000</span><span class="token punctuation">(</span><span class="token class-name">Spider</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">61</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span>Spider</span>$<span class="token number">1.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Spider</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">320</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>thread<span class="token punctuation">.</span></span>CountableThreadPool</span>$<span class="token number">1.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CountableThreadPool</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">74</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1149</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span>$<span class="token class-name">Worker</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">624</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>
<span class="token number">10</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">15.324</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span> <span class="token class-name"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span>Spider</span> <span class="token operator">-</span> <span class="token class-name">Spider</span> github<span class="token punctuation">.</span>com closed<span class="token operator">!</span> <span class="token number">1</span> pages downloaded<span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  那第一个例子就出现这个问题,那得解决呀,是吧?</p>`,4),Y={href:"https://github.com/code4craft/webmagic/issues/701",target:"_blank",rel:"noopener noreferrer"},K=p('<figure><img src="'+d+`" alt="(protocol_version)bug解决" tabindex="0" loading="lazy"><figcaption>(protocol_version)bug解决</figcaption></figure><p>  作者说是会在0.7.4中解决,你可能会说那我们换版本就好了,抱歉,作者可能是工作太忙了,所以0.7.4迟迟不出,那没办法,那咱们就自己改吧。</p><h2 id="手动解决-protocol-version-bug" tabindex="-1"><a class="header-anchor" href="#手动解决-protocol-version-bug" aria-hidden="true">#</a> 手动解决 protocol_version bug</h2><p>  先找到作者说的<code>HttpClientGenerator</code>类中的方法<em>buildSSLConnectionSocketFactory</em>，</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SSLConnectionSocketFactory</span> <span class="token function">buildSSLConnectionSocketFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SSLConnectionSocketFactory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createIgnoreVerifySSL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeyManagementException</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ssl connection fail&quot;</span><span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ssl connection fail&quot;</span><span class="token punctuation">,</span> var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token class-name">SSLConnectionSocketFactory</span><span class="token punctuation">.</span><span class="token function">getSocketFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  将里面的内容改造就行,不过因为是源码,如果你不想重新打包的话,就需要自己去重写引用<code>HttpClientGenerator</code></p><h2 id="如何知道在那里使用上httpclientgenerator的" tabindex="-1"><a class="header-anchor" href="#如何知道在那里使用上httpclientgenerator的" aria-hidden="true">#</a> 如何知道在那里使用上HttpClientGenerator的?</h2><p>​  官网说了,WebMagic的结构分为<code>Downloader</code>、<code>PageProcessor</code>、<code>Scheduler</code>、<code>Pipeline</code>四大组件，</p><p>  那我们怎么知道这四大组件是怎么相互关联的呢?</p><p>​  可以从之前的那个<strong>GithubRepoPageProcessor</strong>类的执行方法中获得</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token class-name">Spider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GithubRepoPageProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addUrl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;https://github.com/code4craft&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  从上可以知道,执行一个爬取任务,需要通过<strong>Spider</strong>去启动,那我们查看一下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spider</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Downloader</span> downloader<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pipeline</span><span class="token punctuation">&gt;</span></span> pipelines <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">PageProcessor</span> pageProcessor<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&gt;</span></span> startRequests<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Site</span> site<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> uuid<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Scheduler</span> scheduler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueueScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">CountableThreadPool</span> threadPool<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">ExecutorService</span> executorService<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> threadNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">AtomicInteger</span> stat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> exitWhenComplete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">STAT_INIT</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">STAT_RUNNING</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">STAT_STOPPED</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> spawnUrl <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> destroyWhenExit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ReentrantLock</span> newUrlLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> newUrlCondition<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpiderListener</span><span class="token punctuation">&gt;</span></span> spiderListeners<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicLong</span> pageCount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> startTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> emptySleepTime<span class="token punctuation">;</span>

    <span class="token comment">// ...... 省略</span>
     
     
    <span class="token doc-comment comment">/** <span class="token keyword">@deprecated</span> */</span>
    <span class="token keyword">public</span> <span class="token class-name">Spider</span> <span class="token function">downloader</span><span class="token punctuation">(</span><span class="token class-name">Downloader</span> downloader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDownloader</span><span class="token punctuation">(</span>downloader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Spider</span> <span class="token function">setDownloader</span><span class="token punctuation">(</span><span class="token class-name">Downloader</span> downloader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIfRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>downloader <span class="token operator">=</span> downloader<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkRunningStat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Spider {} started!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Spider {} closed! {} pages downloaded.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>downloader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 在这里也看到了默认使用 HttpClientDownloader</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>downloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pipelines<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pipelines<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConsolePipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>downloader<span class="token punctuation">.</span><span class="token function">setThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadPool <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>threadPool<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>executorService <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>executorService<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountableThreadPool</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadNum<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountableThreadPool</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startRequests <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Iterator</span> var1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startRequests<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>var1<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token punctuation">)</span>var1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>startRequests<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  从上面可以发现四个都有,我们点击进<strong>Downloader</strong>类</p><p>  可以发现</p><p>​ <img src="`+m+`" alt="Downloader接口实现" loading="lazy"></p><p>  三个实现类(红框内容,my那个是我自己实现的)!</p><p>  然后你点进<strong>HttpClientDownloader</strong>类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>downloader</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token annotation punctuation">@ThreadSafe</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpClientDownloader</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDownloader</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CloseableHttpClient</span><span class="token punctuation">&gt;</span></span> httpClients <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在这里就发现使用HttpClientGenerator</span>
    <span class="token keyword">private</span> <span class="token class-name">HttpClientGenerator</span> httpClientGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">HttpUriRequestConverter</span> httpUriRequestConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpUriRequestConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ProxyProvider</span> proxyProvider<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> responseHeader <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// ......省略</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  从以上我们知道了<strong>Spider</strong>类中有属性<strong>Download</strong>接口,该接口有实现类<strong>HttpClientDownloader</strong>，当你在执行<strong>Spider</strong>.<em>run()<em>时,<em>run()<em>会执行</em>initComponent()</em>，如果你没有设置<strong>Spider</strong>的<code>download</code>属性,就会自动的选择<strong>HttpClientDownloader</strong>作为实现类,而<strong>HttpClientDownloader</strong>中又使用了<strong>HttpClientGenerator</strong>作为参数,那我们既然要改<strong>HttpClientGenerator</strong>类中的方法</em>buildSSLConnectionSocketFactory（）</em>,那就得重写<strong>HttpClientGenerator</strong>和<strong>Download</strong></p>`,20),Q={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/config/MyHttpClientGenerator.java",target:"_blank",rel:"noopener noreferrer"},Z=n("strong",null,"和",-1),nn={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/config/MyHttpClientDownloader.java",target:"_blank",rel:"noopener noreferrer"},sn=n("h2",{id:"怎么使用新得download实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#怎么使用新得download实现","aria-hidden":"true"},"#"),s(" 怎么使用新得Download实现?")],-1),an=p(`<li><p>再在使用<strong>Spider</strong>得时候<em>setDownloader</em>(<strong>MyHttpClientDownloader</strong>)：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Spider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>pageProcessor<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDownloader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyHttpClientDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>或者增加一个类用于继承Spider类,重写<em>initComponent</em>()方法中得：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>downloader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token comment">// 修改这里为 this.downloader = new MyHttpClientDownloader();</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>downloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pipelines<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pipelines<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConsolePipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>downloader<span class="token punctuation">.</span><span class="token function">setThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadPool <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>threadPool<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>executorService <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>executorService<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountableThreadPool</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadNum<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountableThreadPool</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startRequests <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Iterator</span> var1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startRequests<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>var1<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token punctuation">)</span>var1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>startRequests<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,2),tn={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/test/java/com/blacktea/webmagic/demo/WebMagicTest.java",target:"_blank",rel:"noopener noreferrer"},pn=n("em",null,"testDemo1()",-1),en=p(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testDemo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 出现错误 -&gt; javax.net.ssl.SSLHandshakeException: Received fatal alert: protocol_version</span>
<span class="token comment">//        Spider.create(new GithubRepoPageProcessor())</span>
<span class="token comment">//                .addUrl(new String[]{&quot;https://github.com/code4craft&quot;})</span>
<span class="token comment">//                .thread(5).run();</span>

        <span class="token comment">//使用MyHttpClientDownloader解决  protocol_version,但是可能出现github请求超时,这个与github访问有关系,我访问不了</span>
        <span class="token class-name">Spider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GithubRepoPageProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addUrl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;https://github.com/code4craft&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDownloader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyHttpClientDownloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),on=p(`<h2 id="官网其他用例" tabindex="-1"><a class="header-anchor" href="#官网其他用例" aria-hidden="true">#</a> 官网其他用例</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span>processor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>codecraft<span class="token punctuation">.</span>webmagic<span class="token punctuation">.</span></span><span class="token class-name">Site</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PageProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Page</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Site</span> <span class="token function">getSite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你可以通过查找<strong>PageProcessor</strong>接口得实现,得到官网用例,</p><figure><img src="`+v+'" alt="PageProcessor实现" tabindex="0" loading="lazy"><figcaption>PageProcessor实现</figcaption></figure><h2 id="本文实现" tabindex="-1"><a class="header-anchor" href="#本文实现" aria-hidden="true">#</a> 本文实现</h2><h3 id="功能" tabindex="-1"><a class="header-anchor" href="#功能" aria-hidden="true">#</a> 功能</h3>',6),cn={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/controller/ProTestController.java",target:"_blank",rel:"noopener noreferrer"},ln=n("h4",{id:"接口请求报文",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#接口请求报文","aria-hidden":"true"},"#"),s(" 接口请求报文")],-1),un=n("thead",null,[n("tr",null,[n("th",null,"名称"),n("th",null,"必填"),n("th",null,"类型"),n("th",null,"说明")])],-1),kn=n("tr",null,[n("td",null,"fileName"),n("td",null,"true"),n("td",null,"String"),n("td",null,"表示下载后得文件名称(要求带文件类型后缀)；")],-1),rn=n("tr",null,[n("td",null,"itemPageUrl"),n("td",null,"false"),n("td",null,"String"),n("td",null,"目标页面地址；（该项与helpUrl、targetUrl是分开的,只有进行文章详情爬取的时候才需要itemPageUrl）")],-1),dn=n("tr",null,[n("td",null,[n("strong",null,"helpUrl")]),n("td",null,"false"),n("td",null,"String"),n("td",null,"提供需要目标地址的页面url,例如CSDN的列表页;")],-1),mn=n("tr",null,[n("td",null,[n("strong",null,"targetUrl")]),n("td",null,"false"),n("td",null,"String"),n("td",null,"找寻目标地址的匹配url,暂时仅支持 regx 匹配;")],-1),vn=n("tr",null,[n("td",null,"fields"),n("td",null,"true"),n("td",null,[n("code",null,"List<Field>")]),n("td",null,"匹配规则集合，长度必须大于0")],-1),bn=n("tr",null,[n("td",null,"key"),n("td",null,"true"),n("td",null,"String (Field.key)"),n("td",null,"fields[index].key属性,用于标记该条规则得别名,在导出zip时,会自动将该key作为一级或二级(item一级,list二级)目录名称作为zip内文件分区")],-1),gn=n("tr",null,[n("td",null,"value"),n("td",null,"true"),n("td",null,"String (Field.value)"),n("td",null,"fields[index].value属性,用于在页面中进行匹配得内容")],-1),hn=n("td",null,"type",-1),wn=n("td",null,"true",-1),yn=n("td",null,"String (Field.type)",-1),_n={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/util/WebMagicUtil.java",target:"_blank",rel:"noopener noreferrer"},fn=n("strong",null,"matchVal",-1),qn=n("td",null,"fileType",-1),Sn=n("td",null,"true",-1),Cn=n("td",null,"String (Field.fileType)",-1),xn={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/util/WebMagicUtil.java",target:"_blank",rel:"noopener noreferrer"},jn=n("strong",null,"getDataMap",-1),Pn=p('<h3 id="zip分区说明" tabindex="-1"><a class="header-anchor" href="#zip分区说明" aria-hidden="true">#</a> zip分区说明</h3><p>​   为了区分匹配后获取的资源与避免文件名称重复导致文件被覆盖,我这里做了目录分区。</p><p>​1. 当你用<code>itemPageUrl</code> 时,文件结构为： xxx.zip/key/fileType;</p><ol start="2"><li>当你用<code>helpUrl and targetUrl</code>时,文件结构为：第几个页面/key/fileType;</li></ol><h3 id="匹配结果调试" tabindex="-1"><a class="header-anchor" href="#匹配结果调试" aria-hidden="true">#</a> 匹配结果调试</h3>',5),Tn={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/util/WebMagicUtil.java",target:"_blank",rel:"noopener noreferrer"},Hn=n("strong",null,"getSelectableValue",-1),Dn=p(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getSelectableValue</span><span class="token punctuation">(</span><span class="token class-name">Field</span> field<span class="token punctuation">,</span><span class="token class-name">Page</span> page<span class="token punctuation">,</span> <span class="token keyword">boolean</span> all<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Selectable</span> selectable <span class="token operator">=</span> <span class="token class-name">WebMagicUtil</span><span class="token punctuation">.</span><span class="token function">matchVal</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;当前field.key={},匹配的结果为:{}&quot;</span><span class="token punctuation">,</span>field<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>selectable<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Validator</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>selectable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// selectable get()/all(),看导出单个具体文件(md),还是压缩文件(zip)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>all<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">return</span> selectable<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> selectable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  该方法会打印出符合的匹配结果的,默认打印全部结果。</p><h2 id="_1-通用详情页导出md" tabindex="-1"><a class="header-anchor" href="#_1-通用详情页导出md" aria-hidden="true">#</a> 1. 通用详情页导出md</h2><h3 id="_1-1-swagger下载md文件" tabindex="-1"><a class="header-anchor" href="#_1-1-swagger下载md文件" aria-hidden="true">#</a> 1.1 swagger下载md文件</h3>`,4),En={href:"http://localhost:8000/swagger-ui.html#!/ProTestController/exportCSDNMdUsingPOST",target:"_blank",rel:"noopener noreferrer"},zn={href:"http://localhost:8000/pro/item/export/md",target:"_blank",rel:"noopener noreferrer"},Ln=p('<p>post,application/json</p><figure><img src="'+b+`" alt="swagger-md下载请求参数" tabindex="0" loading="lazy"><figcaption>swagger-md下载请求参数</figcaption></figure><h3 id="_1-2-实际入参json-csdn示例" tabindex="-1"><a class="header-anchor" href="#_1-2-实际入参json-csdn示例" aria-hidden="true">#</a> 1.2 实际入参json(CSDN示例)</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;md下载测试.md&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;itemPageUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://blog.csdn.net/weixin_43917143/article/details/120436445&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;md&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//*[@id=\\&quot;article_content\\&quot;]/[@id=\\&quot;content_views\\&quot;]&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;MD&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;md1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//*[@id=\\&quot;article_content\\&quot;]/[@id=\\&quot;content_views\\&quot;]&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;MD&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果多个key，我会把多个key匹配到的内容一起写入到一个md,只要匹配到符合的内容在一个以上就会进行 额外拼接 &quot;# md分割-下一篇\\n\\n&quot;，再拼接下一篇。</p><h3 id="_1-3-效果" tabindex="-1"><a class="header-anchor" href="#_1-3-效果" aria-hidden="true">#</a> 1.3 效果</h3><figure><img src="`+g+'" alt="md下载swagger" tabindex="0" loading="lazy"><figcaption>md下载swagger</figcaption></figure><figure><img src="'+h+'" alt="md文件最终效果" tabindex="0" loading="lazy"><figcaption>md文件最终效果</figcaption></figure><p>  因为我这里爬取的匹配结果为2,所以我就会再拼接一条 &quot;# md分割-下一篇<code>\\n\\n</code>&quot;。</p><p>  注意: 这里不是因为 fields.szie = 2,所以才导出2个的,是因为你所配置的规则匹配后的内容结果为2。</p><p>  有可能你配置的规则没有匹配到内容</p><p>  或者</p><p>  配置 一个规则却可以出现多个拼接</p>',13),Mn={href:"https://gitee.com/zjydzyjs/spring-boot-use-case-collection/blob/master/webmagic/src/main/java/com/blacktea/webmagic/demo/util/WebMagicUtil.java",target:"_blank",rel:"noopener noreferrer"},An=n("strong",null,"csdnProcess",-1),Rn=n("p",null,[s("  "),n("code",null,"all 为false"),s(",即为符合当前这条field规则的最多只取一条,也就是一个匹配结果[0]拼接index=0,")],-1),Un=n("p",null,[s("​  true,取出所有,也就是一个匹配结果"),n("code",null,"[size]"),s(",循环多个拼接。")],-1),Wn=n("h2",{id:"_2-通用详情页导出zip",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-通用详情页导出zip","aria-hidden":"true"},"#"),s(" 2. 通用详情页导出zip")],-1),Nn=n("h3",{id:"_2-1-swagger下载zip",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-1-swagger下载zip","aria-hidden":"true"},"#"),s(" 2.1 swagger下载zip")],-1),In={href:"http://localhost:8000/swagger-ui.html#!/ProTestController/exportCSDNMdUsingPOST",target:"_blank",rel:"noopener noreferrer"},Gn={href:"http://localhost:8000/pro/item/export/zip",target:"_blank",rel:"noopener noreferrer"},Bn=p(`<p>​ post,application/json</p><h3 id="_2-2-json" tabindex="-1"><a class="header-anchor" href="#_2-2-json" aria-hidden="true">#</a> 2.2 json</h3><p>  CSDN示例</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;img下载测试.zip&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;itemPageUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://blog.csdn.net/weixin_43917143/article/details/120436445&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
          <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//*[@id=\\&quot;article_content\\&quot;]//*//img&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;PNG&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;icons&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//div[@class=\\&quot;mouse-box\\&quot;]//img&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;PNG&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>  这里建议使用postman进行测试,postman可以将最终结果文件流保存为zip文件</p><h6 id="_2-3-效果" tabindex="-1"><a class="header-anchor" href="#_2-3-效果" aria-hidden="true">#</a> 2.3 效果</h6><figure><img src="`+w+'" alt="详情zip下载效果" tabindex="0" loading="lazy"><figcaption>详情zip下载效果</figcaption></figure><h2 id="_3-通用列表页获取详情页进行zip导出" tabindex="-1"><a class="header-anchor" href="#_3-通用列表页获取详情页进行zip导出" aria-hidden="true">#</a> 3. 通用列表页获取详情页进行zip导出</h2><h3 id="_3-1下载地址" tabindex="-1"><a class="header-anchor" href="#_3-1下载地址" aria-hidden="true">#</a> 3.1下载地址</h3>',9),Fn={href:"http://localhost:8000/pro/list/export/zip",target:"_blank",rel:"noopener noreferrer"},On=p(`<p>​  post,application/json</p><h3 id="_3-2-请求参数json" tabindex="-1"><a class="header-anchor" href="#_3-2-请求参数json" aria-hidden="true">#</a> 3.2 请求参数json</h3><p>​  CSDN示例:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;xxx.zip&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;helpUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://blog.csdn.net/weixin_43917143&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;targetUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;(https://blog\\\\.csdn\\\\.net/weixin_43917143/article/details/\\\\w+)&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;md&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//*[@id=\\&quot;article_content\\&quot;]/[@id=\\&quot;content_views\\&quot;]&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;MD&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//*[@id=\\&quot;article_content\\&quot;]//*//img&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;PNG&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;icons&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//div[@class=\\&quot;mouse-box\\&quot;]//img&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;PNG&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​  简书示例:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;简书-xxx.zip&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;helpUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://www.jianshu.com/u/7dcee71ee038&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;targetUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;(https://www\\\\.jianshu\\\\.com/p/\\\\w+)&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token string">&quot;md&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;//div[@class=\\&quot;_gp-ck\\&quot;]/section[@class=\\&quot;ouvjEz\\&quot;][1]&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;XPath&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileType&quot;</span><span class="token operator">:</span><span class="token string">&quot;MD&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-效果" tabindex="-1"><a class="header-anchor" href="#_3-3-效果" aria-hidden="true">#</a> 3.3 效果</h3><p>CSDN效果:</p><figure><img src="`+y+'" alt="列表zip下载效果" tabindex="0" loading="lazy"><figcaption>列表zip下载效果</figcaption></figure>',9);function Vn(Xn,$n){const a=l("ExternalLinkIcon");return o(),c("div",null,[f,q,S,n("p",null,[s("  "),n("a",C,[s("WebMagic是一个简单灵活的Java爬虫框架。基于WebMagic，你可以快速开发出一个高效、易维护的爬虫。"),t(a)])]),x,j,P,T,H,n("p",null,[s("  所以我通过"),n("a",D,[s("WebMagic"),t(a)]),s("进行爬取我放置在其他网站的博客再进行上传。")]),E,n("blockquote",null,[z,L,M,A,R,U,n("p",null,[s("其他 参考"),n("a",W,[s("pom"),t(a)])])]),N,n("p",null,[s("   Gitee地址："),n("a",I,[s("https://gitee.com/zjydzyjs/spring-boot-use-case-collection/tree/master/webmagic"),t(a)])]),G,B,n("p",null,[s("  "),n("a",F,[s("webmagic官网"),t(a)])]),n("p",null,[s("  "),n("a",O,[s("webmagic详情文档"),t(a)])]),n("p",null,[s("  这里说一下我的感慨,webmagic的作者是真厉害,他再官方上也说了,该框架是他自己业余开发,这个精神值得佩服,在此感谢作者("),n("a",V,[s("Yihua Huang"),t(a)]),s(");")]),X,n("p",null,[s("  你直接通过通过以下用例进行调用就可以测试了,在类"),n("a",$,[s("{@link com.blacktea.webmagic.demo.WebMagicTest}"),t(a)]),s("里,")]),J,n("p",null,[s("  于是我就在github的"),n("a",Y,[s("issues"),t(a)]),s("找到了该问题！")]),K,n("p",null,[s("  实现，得到**"),n("a",Q,[s("MyHttpClientGenerator"),t(a)]),Z,n("a",nn,[s("MyHttpClientDownloader"),t(a)]),s("**。")]),sn,n("ol",null,[an,n("li",null,[n("p",null,[s("再次执行"),n("a",tn,[pn,t(a)]),s("：")]),en])]),on,n("p",null,[s("  当前版本通过webmagic实现三个"),n("a",cn,[s("接口"),t(a)]),s("，可实现三个通用功能。")]),ln,n("table",null,[un,n("tbody",null,[kn,rn,dn,mn,vn,bn,gn,n("tr",null,[hn,wn,yn,n("td",null,[s("fields[index].type属性,与Field.value进行组合使用,当前支持 ['XPath', 'Regex', 'Css', 'JsonPath']，是对webmagi{@link us.codecraft.webmagic.model.annotation.Type}得复用，"),n("a",_n,[s("源码"),t(a)]),s("下得"),fn,s("()方法")])]),n("tr",null,[qn,Sn,Cn,n("td",null,[s("fields[index].fileType属性,是对进行匹配后得到结果数据按照类型进行处理,"),n("a",xn,[s("源码"),t(a)]),s("下得"),jn,s("()方法")])])])]),Pn,n("p",null,[n("a",Tn,[s("WebMagicUtil."),Hn,s("()"),t(a)])]),Dn,n("p",null,[s("  使用swagger-ui进行md文件下载,"),n("a",En,[s("地址"),t(a)]),s(" -> "),n("a",zn,[s("http://localhost:8000/pro/item/export/md"),t(a)])]),Ln,n("p",null,[s("  多个拼接("),n("a",Mn,[s("多个根据WebMagicUtil."),An,s("()的all参数决定"),t(a)]),s(")也是有可能的!")]),Rn,Un,Wn,Nn,n("p",null,[s("​  使用swagger-ui进行zip文件下载,"),n("a",In,[s("地址"),t(a)]),s(" -> "),n("a",Gn,[s("http://localhost:8000/pro/item/export/zip"),t(a)])]),Bn,n("p",null,[s("​  "),n("a",Fn,[s("http://localhost:8000/pro/list/export/zip"),t(a)])]),On])}const Yn=e(_,[["render",Vn],["__file","SpringBoot整合WebMagic.html.vue"]]);export{Yn as default};
